<section class="d-flex flex-column gap-4">
  <!-- HEADER -->
  <section class="d-flex flex-wrap justify-content-between align-items-start gap-3">
    <div>
      <h1 class="h3 mb-1">Transactions</h1>
      <p class="text-muted mb-0">View and manage all your transactions</p>
    </div>

    <div class="d-flex flex-wrap gap-2">
      <button class="btn btn-outline-primary btn-sm" (click)="setDateFilter('month')">
        ðŸ“… This Month
      </button>
      <button class="btn btn-primary btn-sm" (click)="openAddTransactionModal()">âž• Add</button>
      <button class="btn btn-outline-secondary btn-sm hide" (click)="toggleView()">
        {{ currentView === 'grid' ? 'ðŸ“… Calendar View' : 'ðŸ“‹ Grid View' }}
      </button>
    </div>
  </section>

  <!-- FILTERS -->
  <section class="card shadow-sm">
    <div class="card-body">
      <app-spinner *ngIf="isGetAccountsLoading && isGetCategoriesLoading" />
      <div class="row g-2 align-items-end">
        <div class="col-12 col-md-3 col-lg-2">
          <label class="form-label small text-muted">Type</label>
          <select class="form-select" [(ngModel)]="filters.type">
            <option value="">All Types</option>
            <option value="income">Income</option>
            <option value="expense">Expense</option>
            <option value="transfer">Transfer</option>
          </select>
        </div>

        <div class="col-12 col-md-3 col-lg-2">
          <label class="form-label small text-muted">Account</label>
          <select class="form-select" [(ngModel)]="filters.account">
            <option value="">All Accounts</option>
            <option *ngFor="let acc of accounts" [value]="acc.id">{{ acc.name }}</option>
          </select>
        </div>

        <div class="col-12 col-md-3 col-lg-2">
          <label class="form-label small text-muted">Category</label>
          <select class="form-select" [(ngModel)]="filters.category">
            <option value="">All Categories</option>
            <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
          </select>
        </div>

        <div class="col-12 col-md-3 col-lg-2">
          <label class="form-label small text-muted">Start Date</label>
          <input class="form-control" type="date" [(ngModel)]="filters.startDate" />
        </div>

        <div class="col-12 col-md-3 col-lg-2">
          <label class="form-label small text-muted">End Date</label>
          <input class="form-control" type="date" [(ngModel)]="filters.endDate" />
        </div>

        <div class="col-12 col-md-3 col-lg-2 d-grid">
          <button class="btn btn-primary" (click)="applyFilters()">Apply</button>
        </div>
      </div>
    </div>
  </section>

  <!-- MAIN CONTENT -->
  <section class="card shadow-sm">
    <div class="card-body">
      <app-spinner *ngIf="isTransactionLoading" />

      @if (currentView === 'grid') {
        <!-- GRID VIEW -->
        <div class="table-responsive">
          <table class="table table-hover align-middle transaction-table">
            <thead class="table-light">
              <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Category</th>
                <th>Account</th>
                <th class="text-end">Amount</th>
                <th>Note</th>
                <th class="text-center">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let t of transactions" class="position-relative">
                <td>{{ t.date | date: 'shortDate' }}</td>
                <td>{{ t.type }}</td>
                <td>{{ t.categoryName }}</td>
                <td>{{ t.accountName }}</td>
                <td [ngClass]="t.type" class="fw-semibold text-end">
                  {{ t.type === 'Expense' ? '-' : '+' }} à§³ {{ t.amount }}
                </td>
                <td>{{ t.description }}</td>
                <td class="text-center">
                  <button
                    mat-icon-button
                    color="primary"
                    (click)="editTransaction(t)"
                    [disabled]="isTransactionDeleting[t.id]"
                  >
                    <mat-icon>edit_square</mat-icon>
                  </button>
                  <button
                    mat-icon-button
                    color="warn"
                    (click)="deleteTransaction(t.id)"
                    [disabled]="isTransactionDeleting[t.id]"
                  >
                    @if (isTransactionDeleting[t.id]) {
                      <mat-progress-spinner mode="indeterminate" diameter="24" />
                    } @else {
                      <mat-icon>delete</mat-icon>
                    }
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      } @else {
        <!-- CALENDAR VIEW -->
        <app-calendar-component [transactions]="transactions" />
      }
    </div>
  </section>
</section>
